// ÏûêÎèôÌôî Í¥ÄÎ¶¨ Ïª¥Ìè¨ÎÑåÌä∏
import { useEffect, useState } from "react";

interface AutomationTask {
  id: string;
  name: string;
  type: "order_processing" | "alert" | "backup" | "maintenance" | "report";
  status: "active" | "inactive" | "running" | "error";
  schedule: {
    type: "interval" | "cron" | "trigger";
    value: string;
    lastRun?: string;
    nextRun?: string;
  };
  config: {
    [key: string]: any;
  };
  logs: AutomationLog[];
  createdAt: string;
  updatedAt: string;
}

interface AutomationLog {
  id: string;
  taskId: string;
  startTime: string;
  endTime?: string;
  status: "running" | "success" | "error" | "cancelled";
  message: string;
  details?: any;
}

interface AutomationRule {
  id: string;
  name: string;
  description: string;
  trigger: {
    type:
      | "order_created"
      | "payment_received"
      | "user_registered"
      | "time_based";
    conditions: any;
  };
  actions: {
    type:
      | "send_notification"
      | "process_order"
      | "update_status"
      | "run_script";
    config: any;
  }[];
  isActive: boolean;
  executionCount: number;
  lastExecuted?: string;
}

export default function AutomationManagement() {
  const [activeTab, setActiveTab] = useState<
    "tasks" | "rules" | "logs" | "templates"
  >("tasks");
  const [tasks, setTasks] = useState<AutomationTask[]>([]);
  const [rules, setRules] = useState<AutomationRule[]>([]);
  const [logs, setLogs] = useState<AutomationLog[]>([]);
  const [loading, setLoading] = useState(true);
  const [selectedTask, setSelectedTask] = useState<AutomationTask | null>(null);
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [newTaskForm, setNewTaskForm] = useState({
    name: "",
    type: "order_processing" as AutomationTask["type"],
    schedule: {
      type: "interval" as "interval" | "cron" | "trigger",
      value: "30",
    },
    config: {},
  });

  useEffect(() => {
    loadAutomationData();

    // Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ (5Ï¥àÎßàÎã§)
    const interval = setInterval(loadAutomationData, 5000);
    return () => clearInterval(interval);
  }, []);

  const loadAutomationData = async () => {
    try {
      setLoading(true);

      // ÏãúÎÆ¨Î†àÏù¥ÏÖò Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
      const mockTasks: AutomationTask[] = [
        {
          id: "task-1",
          name: "ÏûêÎèô Ï£ºÎ¨∏ Ï≤òÎ¶¨",
          type: "order_processing",
          status: "active",
          schedule: {
            type: "interval",
            value: "5",
            lastRun: new Date(Date.now() - 300000).toISOString(),
            nextRun: new Date(Date.now() + 300000).toISOString(),
          },
          config: {
            maxOrdersPerRun: 50,
            priorityFilter: "premium",
            autoApprove: true,
          },
          logs: [],
          createdAt: new Date(Date.now() - 86400000).toISOString(),
          updatedAt: new Date().toISOString(),
        },
        {
          id: "task-2",
          name: "ÏùºÏùº Î∞±ÏóÖ",
          type: "backup",
          status: "active",
          schedule: {
            type: "cron",
            value: "0 2 * * *",
            lastRun: new Date(Date.now() - 3600000 * 22).toISOString(),
            nextRun: new Date(Date.now() + 3600000 * 2).toISOString(),
          },
          config: {
            includeFiles: true,
            includeDatabase: true,
            retention: 30,
          },
          logs: [],
          createdAt: new Date(Date.now() - 604800000).toISOString(),
          updatedAt: new Date().toISOString(),
        },
        {
          id: "task-3",
          name: "ÏãúÏä§ÌÖú Î™®ÎãàÌÑ∞ÎßÅ ÏïåÎ¶º",
          type: "alert",
          status: "running",
          schedule: {
            type: "interval",
            value: "1",
            lastRun: new Date(Date.now() - 60000).toISOString(),
            nextRun: new Date(Date.now() + 60000).toISOString(),
          },
          config: {
            cpuThreshold: 80,
            memoryThreshold: 85,
            diskThreshold: 90,
            responseTimeThreshold: 5000,
          },
          logs: [],
          createdAt: new Date(Date.now() - 259200000).toISOString(),
          updatedAt: new Date().toISOString(),
        },
      ];

      const mockRules: AutomationRule[] = [
        {
          id: "rule-1",
          name: "Ïã†Í∑ú Ï£ºÎ¨∏ ÏûêÎèô ÏäπÏù∏",
          description: "ÌîÑÎ¶¨ÎØ∏ÏóÑ Í≥†Í∞ùÏùò Ï£ºÎ¨∏ÏùÑ ÏûêÎèôÏúºÎ°ú ÏäπÏù∏Ìï©ÎãàÎã§.",
          trigger: {
            type: "order_created",
            conditions: {
              userTier: "premium",
              orderAmount: { min: 0, max: 100000 },
            },
          },
          actions: [
            {
              type: "update_status",
              config: { status: "approved" },
            },
            {
              type: "send_notification",
              config: {
                template: "order_approved",
                recipients: ["customer", "admin"],
              },
            },
          ],
          isActive: true,
          executionCount: 247,
          lastExecuted: new Date(Date.now() - 1800000).toISOString(),
        },
        {
          id: "rule-2",
          name: "Í≤∞Ï†ú ÏôÑÎ£å Ï≤òÎ¶¨",
          description: "Í≤∞Ï†ú ÌôïÏù∏ Ïãú Ï£ºÎ¨∏ÏùÑ ÏûêÎèôÏúºÎ°ú Ï≤òÎ¶¨ ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤ΩÌï©ÎãàÎã§.",
          trigger: {
            type: "payment_received",
            conditions: {
              paymentStatus: "completed",
            },
          },
          actions: [
            {
              type: "update_status",
              config: { status: "processing" },
            },
            {
              type: "run_script",
              config: { script: "start_fulfillment.py" },
            },
          ],
          isActive: true,
          executionCount: 1024,
          lastExecuted: new Date(Date.now() - 900000).toISOString(),
        },
      ];

      const mockLogs: AutomationLog[] = [
        {
          id: "log-1",
          taskId: "task-1",
          startTime: new Date(Date.now() - 300000).toISOString(),
          endTime: new Date(Date.now() - 299000).toISOString(),
          status: "success",
          message: "45Í∞ú Ï£ºÎ¨∏ ÏûêÎèô Ï≤òÎ¶¨ ÏôÑÎ£å",
          details: { processedOrders: 45, errors: 0 },
        },
        {
          id: "log-2",
          taskId: "task-3",
          startTime: new Date(Date.now() - 60000).toISOString(),
          endTime: new Date(Date.now() - 59000).toISOString(),
          status: "success",
          message: "ÏãúÏä§ÌÖú ÏÉÅÌÉú Ï†ïÏÉÅ",
          details: { cpu: 45, memory: 62, disk: 73, responseTime: 234 },
        },
        {
          id: "log-3",
          taskId: "task-2",
          startTime: new Date(Date.now() - 3600000 * 22).toISOString(),
          endTime: new Date(Date.now() - 3600000 * 22 + 180000).toISOString(),
          status: "success",
          message: "Î∞±ÏóÖ ÏôÑÎ£å (2.3GB)",
          details: { fileSize: "2.3GB", duration: "3Î∂Ñ" },
        },
      ];

      setTasks(mockTasks);
      setRules(mockRules);
      setLogs(mockLogs);
    } catch (error) {
      console.error("ÏûêÎèôÌôî Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:", error);
    } finally {
      setLoading(false);
    }
  };

  const toggleTaskStatus = (taskId: string) => {
    setTasks((prev) =>
      prev.map((task) =>
        task.id === taskId
          ? {
              ...task,
              status: task.status === "active" ? "inactive" : "active",
            }
          : task,
      ),
    );
  };

  const runTaskNow = (taskId: string) => {
    setTasks((prev) =>
      prev.map((task) =>
        task.id === taskId
          ? {
              ...task,
              status: "running",
              schedule: {
                ...task.schedule,
                lastRun: new Date().toISOString(),
              },
            }
          : task,
      ),
    );

    // 5Ï¥à ÌõÑ ÏôÑÎ£å ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
    setTimeout(() => {
      setTasks((prev) =>
        prev.map((task) =>
          task.id === taskId ? { ...task, status: "active" } : task,
        ),
      );
    }, 5000);
  };

  const createTask = () => {
    const newTask: AutomationTask = {
      id: `task-${Date.now()}`,
      name: newTaskForm.name,
      type: newTaskForm.type,
      status: "inactive",
      schedule: {
        ...newTaskForm.schedule,
        nextRun: new Date(Date.now() + 60000).toISOString(),
      },
      config: newTaskForm.config,
      logs: [],
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
    };

    setTasks((prev) => [...prev, newTask]);
    setShowCreateModal(false);
    setNewTaskForm({
      name: "",
      type: "order_processing",
      schedule: { type: "interval", value: "30" },
      config: {},
    });
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case "active":
        return "text-green-600 bg-green-100";
      case "inactive":
        return "text-gray-600 bg-gray-100";
      case "running":
        return "text-blue-600 bg-blue-100";
      case "error":
        return "text-red-600 bg-red-100";
      default:
        return "text-gray-600 bg-gray-100";
    }
  };

  const getTaskTypeIcon = (type: string) => {
    switch (type) {
      case "order_processing":
        return "üì¶";
      case "alert":
        return "üö®";
      case "backup":
        return "üíæ";
      case "maintenance":
        return "üîß";
      case "report":
        return "üìä";
      default:
        return "‚öôÔ∏è";
    }
  };

  const formatSchedule = (schedule: AutomationTask["schedule"]) => {
    if (schedule.type === "interval") {
      return `Îß§ ${schedule.value}Î∂Ñ`;
    } else if (schedule.type === "cron") {
      return `ÌÅ¨Î°†: ${schedule.value}`;
    }
    return "Ìä∏Î¶¨Í±∞ Í∏∞Î∞ò";
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */}
      <div className="border-b">
        <nav className="flex space-x-8">
          {[
            { id: "tasks", name: "ÏûêÎèôÌôî ÏûëÏóÖ", icon: "‚öôÔ∏è" },
            { id: "rules", name: "ÏûêÎèôÌôî Í∑úÏπô", icon: "üìã" },
            { id: "logs", name: "Ïã§Ìñâ Î°úÍ∑∏", icon: "üìù" },
            { id: "templates", name: "ÌÖúÌîåÎ¶ø", icon: "üìÑ" },
          ].map((tab) => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as any)}
              className={`py-2 px-1 border-b-2 font-medium text-sm ${
                activeTab === tab.id
                  ? "border-blue-500 text-blue-600"
                  : "border-transparent text-gray-500 hover:text-gray-700"
              }`}
            >
              {tab.icon} {tab.name}
            </button>
          ))}
        </nav>
      </div>

      {/* ÏûêÎèôÌôî ÏûëÏóÖ ÌÉ≠ */}
      {activeTab === "tasks" && (
        <div className="space-y-4">
          <div className="flex justify-between items-center">
            <h2 className="text-xl font-semibold">ÏûêÎèôÌôî ÏûëÏóÖ</h2>
            <button
              onClick={() => setShowCreateModal(true)}
              className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              + ÏÉà ÏûëÏóÖ ÏÉùÏÑ±
            </button>
          </div>

          <div className="grid gap-4">
            {tasks.map((task) => (
              <div key={task.id} className="bg-white p-6 rounded-lg shadow">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center space-x-3">
                    <span className="text-2xl">
                      {getTaskTypeIcon(task.type)}
                    </span>
                    <div>
                      <h3 className="font-semibold">{task.name}</h3>
                      <p className="text-sm text-gray-600">
                        {formatSchedule(task.schedule)}
                      </p>
                    </div>
                  </div>
                  <div className="flex items-center space-x-2">
                    <span
                      className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(task.status)}`}
                    >
                      {task.status}
                    </span>
                    <button
                      onClick={() => toggleTaskStatus(task.id)}
                      className={`px-3 py-1 rounded text-sm ${
                        task.status === "active"
                          ? "bg-red-100 text-red-600 hover:bg-red-200"
                          : "bg-green-100 text-green-600 hover:bg-green-200"
                      }`}
                    >
                      {task.status === "active" ? "Ï†ïÏßÄ" : "ÏãúÏûë"}
                    </button>
                    <button
                      onClick={() => runTaskNow(task.id)}
                      disabled={task.status === "running"}
                      className="px-3 py-1 bg-blue-100 text-blue-600 rounded text-sm hover:bg-blue-200 disabled:opacity-50"
                    >
                      ÏßÄÍ∏à Ïã§Ìñâ
                    </button>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                  <div>
                    <span className="text-gray-500">ÎßàÏßÄÎßâ Ïã§Ìñâ:</span>
                    <div className="font-medium">
                      {task.schedule.lastRun
                        ? new Date(task.schedule.lastRun).toLocaleString()
                        : "Ïã§Ìñâ Í∏∞Î°ù ÏóÜÏùå"}
                    </div>
                  </div>
                  <div>
                    <span className="text-gray-500">Îã§Ïùå Ïã§Ìñâ:</span>
                    <div className="font-medium">
                      {task.schedule.nextRun
                        ? new Date(task.schedule.nextRun).toLocaleString()
                        : "ÏòàÏ†ï ÏóÜÏùå"}
                    </div>
                  </div>
                  <div>
                    <span className="text-gray-500">ÏÉùÏÑ±Ïùº:</span>
                    <div className="font-medium">
                      {new Date(task.createdAt).toLocaleDateString()}
                    </div>
                  </div>
                </div>

                {task.status === "running" && (
                  <div className="mt-4 flex items-center space-x-2 text-sm text-blue-600">
                    <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
                    <span>Ïã§Ìñâ Ï§ë...</span>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      )}

      {/* ÏûêÎèôÌôî Í∑úÏπô ÌÉ≠ */}
      {activeTab === "rules" && (
        <div className="space-y-4">
          <div className="flex justify-between items-center">
            <h2 className="text-xl font-semibold">ÏûêÎèôÌôî Í∑úÏπô</h2>
            <button className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
              + ÏÉà Í∑úÏπô ÏÉùÏÑ±
            </button>
          </div>

          <div className="grid gap-4">
            {rules.map((rule) => (
              <div key={rule.id} className="bg-white p-6 rounded-lg shadow">
                <div className="flex items-center justify-between mb-4">
                  <div>
                    <h3 className="font-semibold">{rule.name}</h3>
                    <p className="text-sm text-gray-600">{rule.description}</p>
                  </div>
                  <div className="flex items-center space-x-2">
                    <span
                      className={`px-2 py-1 rounded-full text-xs font-medium ${
                        rule.isActive
                          ? "bg-green-100 text-green-600"
                          : "bg-gray-100 text-gray-600"
                      }`}
                    >
                      {rule.isActive ? "ÌôúÏÑ±" : "ÎπÑÌôúÏÑ±"}
                    </span>
                    <button className="px-3 py-1 bg-blue-100 text-blue-600 rounded text-sm hover:bg-blue-200">
                      Ìé∏Ïßë
                    </button>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                  <div>
                    <span className="text-gray-500">Ìä∏Î¶¨Í±∞:</span>
                    <div className="font-medium">{rule.trigger.type}</div>
                  </div>
                  <div>
                    <span className="text-gray-500">Ïã§Ìñâ ÌöüÏàò:</span>
                    <div className="font-medium">
                      {rule.executionCount.toLocaleString()}
                    </div>
                  </div>
                  <div>
                    <span className="text-gray-500">ÎßàÏßÄÎßâ Ïã§Ìñâ:</span>
                    <div className="font-medium">
                      {rule.lastExecuted
                        ? new Date(rule.lastExecuted).toLocaleString()
                        : "Ïã§Ìñâ Í∏∞Î°ù ÏóÜÏùå"}
                    </div>
                  </div>
                </div>

                <div className="mt-4">
                  <span className="text-gray-500 text-sm">Ïï°ÏÖò:</span>
                  <div className="mt-1 flex flex-wrap gap-2">
                    {rule.actions.map((action, index) => (
                      <span
                        key={index}
                        className="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs"
                      >
                        {action.type}
                      </span>
                    ))}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Ïã§Ìñâ Î°úÍ∑∏ ÌÉ≠ */}
      {activeTab === "logs" && (
        <div className="space-y-4">
          <h2 className="text-xl font-semibold">Ïã§Ìñâ Î°úÍ∑∏</h2>

          <div className="bg-white rounded-lg shadow overflow-hidden">
            <div className="overflow-x-auto">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      ÏûëÏóÖ
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      ÏÉÅÌÉú
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      ÏãúÏûë ÏãúÍ∞Ñ
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      ÏÜåÏöî ÏãúÍ∞Ñ
                    </th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Î©îÏãúÏßÄ
                    </th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {logs.map((log) => {
                    const task = tasks.find((t) => t.id === log.taskId);
                    const duration = log.endTime
                      ? Math.round(
                          (new Date(log.endTime).getTime() -
                            new Date(log.startTime).getTime()) /
                            1000,
                        )
                      : null;

                    return (
                      <tr key={log.id}>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <div className="flex items-center">
                            <span className="mr-2">
                              {getTaskTypeIcon(task?.type || "")}
                            </span>
                            <span className="text-sm font-medium text-gray-900">
                              {task?.name || "Ïïå Ïàò ÏóÜÎäî ÏûëÏóÖ"}
                            </span>
                          </div>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <span
                            className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(log.status)}`}
                          >
                            {log.status}
                          </span>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {new Date(log.startTime).toLocaleString()}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {duration ? `${duration}Ï¥à` : "-"}
                        </td>
                        <td className="px-6 py-4 text-sm text-gray-900">
                          {log.message}
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      )}

      {/* ÌÖúÌîåÎ¶ø ÌÉ≠ */}
      {activeTab === "templates" && (
        <div className="space-y-4">
          <h2 className="text-xl font-semibold">ÏûêÎèôÌôî ÌÖúÌîåÎ¶ø</h2>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {[
              {
                name: "Ï£ºÎ¨∏ ÏûêÎèô Ï≤òÎ¶¨",
                description: "Ïã†Í∑ú Ï£ºÎ¨∏ÏùÑ ÏûêÎèôÏúºÎ°ú Í≤ÄÌÜ†ÌïòÍ≥† ÏäπÏù∏Ìï©ÎãàÎã§.",
                icon: "üì¶",
                category: "Ï£ºÎ¨∏ Í¥ÄÎ¶¨",
              },
              {
                name: "ÏùºÏùº Î∞±ÏóÖ",
                description: "Îß§Ïùº ÏûêÎèôÏúºÎ°ú Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ÏôÄ ÌååÏùºÏùÑ Î∞±ÏóÖÌï©ÎãàÎã§.",
                icon: "üíæ",
                category: "ÏãúÏä§ÌÖú",
              },
              {
                name: "ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ",
                description:
                  "ÏãúÏä§ÌÖú ÏÑ±Îä•ÏùÑ Î™®ÎãàÌÑ∞ÎßÅÌïòÍ≥† Ïù¥ÏÉÅ Ïãú ÏïåÎ¶ºÏùÑ Î≥¥ÎÉÖÎãàÎã§.",
                icon: "üìà",
                category: "Î™®ÎãàÌÑ∞ÎßÅ",
              },
              {
                name: "ÏÇ¨Ïö©Ïûê ÏïåÎ¶º",
                description:
                  "ÌäπÏ†ï Ïù¥Î≤§Ìä∏ Î∞úÏÉù Ïãú ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶ºÏùÑ Î∞úÏÜ°Ìï©ÎãàÎã§.",
                icon: "üîî",
                category: "ÏïåÎ¶º",
              },
              {
                name: "Î≥¥Í≥†ÏÑú ÏÉùÏÑ±",
                description: "Ï£ºÍ∏∞Ï†ÅÏúºÎ°ú Î∂ÑÏÑù Î≥¥Í≥†ÏÑúÎ•º ÏÉùÏÑ±ÌïòÍ≥† Ï†ÑÏÜ°Ìï©ÎãàÎã§.",
                icon: "üìä",
                category: "Î≥¥Í≥†ÏÑú",
              },
              {
                name: "Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨",
                description: "Ïò§ÎûòÎêú Î°úÍ∑∏ÏôÄ ÏûÑÏãú ÌååÏùºÏùÑ ÏûêÎèôÏúºÎ°ú Ï†ïÎ¶¨Ìï©ÎãàÎã§.",
                icon: "üßπ",
                category: "Ïú†ÏßÄÎ≥¥Ïàò",
              },
            ].map((template, index) => (
              <div
                key={index}
                className="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow cursor-pointer"
              >
                <div className="flex items-center justify-between mb-3">
                  <span className="text-2xl">{template.icon}</span>
                  <span className="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                    {template.category}
                  </span>
                </div>
                <h3 className="font-semibold mb-2">{template.name}</h3>
                <p className="text-sm text-gray-600 mb-4">
                  {template.description}
                </p>
                <button className="w-full px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                  ÌÖúÌîåÎ¶ø ÏÇ¨Ïö©
                </button>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* ÏûëÏóÖ ÏÉùÏÑ± Î™®Îã¨ */}
      {showCreateModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-6 rounded-lg w-96 max-w-full">
            <h3 className="text-lg font-semibold mb-4">ÏÉà ÏûêÎèôÌôî ÏûëÏóÖ ÏÉùÏÑ±</h3>

            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  ÏûëÏóÖ Ïù¥Î¶Ñ
                </label>
                <input
                  type="text"
                  value={newTaskForm.name}
                  onChange={(e) =>
                    setNewTaskForm((prev) => ({
                      ...prev,
                      name: e.target.value,
                    }))
                  }
                  className="w-full px-3 py-2 border rounded-md"
                  placeholder="ÏûëÏóÖ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  ÏûëÏóÖ Ïú†Ìòï
                </label>
                <select
                  value={newTaskForm.type}
                  onChange={(e) =>
                    setNewTaskForm((prev) => ({
                      ...prev,
                      type: e.target.value as AutomationTask["type"],
                    }))
                  }
                  className="w-full px-3 py-2 border rounded-md"
                >
                  <option value="order_processing">Ï£ºÎ¨∏ Ï≤òÎ¶¨</option>
                  <option value="alert">ÏïåÎ¶º</option>
                  <option value="backup">Î∞±ÏóÖ</option>
                  <option value="maintenance">Ïú†ÏßÄÎ≥¥Ïàò</option>
                  <option value="report">Î≥¥Í≥†ÏÑú</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Ïã§Ìñâ Ï£ºÍ∏∞
                </label>
                <div className="flex space-x-2">
                  <select
                    value={newTaskForm.schedule.type}
                    onChange={(e) =>
                      setNewTaskForm((prev) => ({
                        ...prev,
                        schedule: {
                          ...prev.schedule,
                          type: e.target.value as
                            | "interval"
                            | "cron"
                            | "trigger",
                        },
                      }))
                    }
                    className="px-3 py-2 border rounded-md"
                  >
                    <option value="interval">Í∞ÑÍ≤©</option>
                    <option value="cron">ÌÅ¨Î°†</option>
                    <option value="trigger">Ìä∏Î¶¨Í±∞</option>
                  </select>
                  <input
                    type="text"
                    value={newTaskForm.schedule.value}
                    onChange={(e) =>
                      setNewTaskForm((prev) => ({
                        ...prev,
                        schedule: { ...prev.schedule, value: e.target.value },
                      }))
                    }
                    className="flex-1 px-3 py-2 border rounded-md"
                    placeholder={
                      newTaskForm.schedule.type === "interval"
                        ? "Î∂Ñ"
                        : "cron ÌëúÌòÑÏãù"
                    }
                  />
                </div>
              </div>
            </div>

            <div className="flex justify-end space-x-3 mt-6">
              <button
                onClick={() => setShowCreateModal(false)}
                className="px-4 py-2 text-gray-600 border rounded hover:bg-gray-50"
              >
                Ï∑®ÏÜå
              </button>
              <button
                onClick={createTask}
                disabled={!newTaskForm.name}
                className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50"
              >
                ÏÉùÏÑ±
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
